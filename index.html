<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="RunDouble">
<meta property="og:type" content="website">
<meta property="og:title" content="Flamingo&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Flamingo&#39;s Blog">
<meta property="og:description" content="RunDouble">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Flamingo&#39;s Blog">
<meta name="twitter:description" content="RunDouble">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Flamingo's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Flamingo's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">hs</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/EJBCA使用教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/EJBCA使用教程/" itemprop="url">EJBCA使用教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-05T15:01:40+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="web管理界面"><a href="#web管理界面" class="headerlink" title="web管理界面"></a>web管理界面</h1><h2 id="web页面"><a href="#web页面" class="headerlink" title="web页面"></a>web页面</h2><ul>
<li>拷贝ejbca服务器“/opt/ca/ejbca-ce-6.3.1.1/p12/”下的superadmin.p12到windows，双击安装，密码“ejbca”,ejbca提供了两个界面。</li>
<li>管理员界面(需要证书，使用刚才安装的supeadmin证书)：<code>https://by.cos7:8443/ejbca/adminweb/</code><img src="https://i.imgur.com/o3c0AcR.png" alt=""></li>
<li>用户界面：<code>http://by.cos7:8080/ejbca/</code><img src="https://i.imgur.com/MPIAwpH.png" alt=""><h2 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h2></li>
<li>ejbca管理员界面，打开<code>RA Functions-&gt;Add End Entity</code>菜单，填写“Required”列打勾的项。</li>
<li>用户模板选择“EMPTY”：<img src="https://i.imgur.com/wKDtk0Q.png" alt=""></li>
<li>输入用户名和密码：<img src="https://i.imgur.com/4mEjZId.png" alt=""></li>
<li>Common name，如果是服务器用证书，这里填域名：<img src="https://i.imgur.com/VIvMfTK.png" alt=""></li>
<li>证书信息填写，证书模板选择“ENDUSER”，CA选择“dev”,Token选择“P12 file”:<img src="https://i.imgur.com/e5DAZKp.png" alt=""></li>
<li>点击“Add”注册<h2 id="下载证书"><a href="#下载证书" class="headerlink" title="下载证书"></a>下载证书</h2></li>
<li>ejbca用户界面，打开“Enroll”-“Create Browser Certificate”菜单：<img src="https://i.imgur.com/0wNUVFl.png" alt=""></li>
<li>“Key length”选择“2048 bits”;“Cetificate profile”选择“ENDUSER”,点击“Enroll”按钮下载证书：<img src="https://i.imgur.com/pH3qyIG.png" alt=""><h2 id="吊销证书"><a href="#吊销证书" class="headerlink" title="吊销证书"></a>吊销证书</h2></li>
<li>ejbca管理员界面，打开“RA Functions”—“Search End Entities”菜单。“Search end entities with status”处下拉框选择“All”，点击右边的“Search”按钮查看用户信息（下图省略其他列）勾选需要吊销的用户，点击表格下方的“Revoke Selected”按钮：<img src="https://i.imgur.com/4serhaB.png" alt=""><h2 id="更新证书"><a href="#更新证书" class="headerlink" title="更新证书"></a>更新证书</h2></li>
<li>ejbca管理员界面，打开“RA Functions”—“Search End Entities”菜单。“Search end entities with status”处下拉框选择“All”，点击右边的“Search”按钮查看用户信息（下图省略其他列）<img src="https://i.imgur.com/zbAzu7x.png" alt=""></li>
<li>点击需要更新的证书用户的最右边列中的“Edit End Entity”超链接，编辑用户：<img src="https://i.imgur.com/8oyBfPo.png" alt=""></li>
<li>设置“Status”为“New”，点击右边的“Save”按钮。然后输入新密码，其他项保持不变，点击页面最下方的“Save”按钮保存设置。<h2 id="根证书"><a href="#根证书" class="headerlink" title="根证书"></a>根证书</h2></li>
<li>ejbca用户界面，打开“Retrieve”—“Fetch CA Certificates”菜单，可以下载不同格式的根证书<h2 id="申请tomcate服务器证书"><a href="#申请tomcate服务器证书" class="headerlink" title="申请tomcate服务器证书"></a>申请tomcate服务器证书</h2></li>
<li>用户注册时，证书模板选择“SERVER”,Token选择“JKS file”,其他项不变：<img src="https://i.imgur.com/vellQeB.png" alt=""></li>
<li>下载证书时，在ejbca用户界面中，打开“Enroll”—“Create Keystore”菜单，输入用户名与密码，进入下面的页面<img src="https://i.imgur.com/D2pi1Uf.png" alt=""></li>
<li>“Key length”选择“2048 bits”；“Certificate profile”选择“SERVER”，点击“Enroll”按钮下载证书：<img src="https://i.imgur.com/9XHTrKd.png" alt=""><h1 id="ejbca的web-service-interface"><a href="#ejbca的web-service-interface" class="headerlink" title="ejbca的web service interface"></a>ejbca的web service interface</h1></li>
<li>ejbca系统装好了，可以管理数字证书了，但是，所有的操作都在ejbca界面中执行，挺麻烦的，因此，最合理的做法是在ejbca之上构建中间层，用户访问中间层提供的服务，中间层调用ejbca的web service interface<h2 id="superadmin-jks证书"><a href="#superadmin-jks证书" class="headerlink" title="superadmin.jks证书"></a>superadmin.jks证书</h2></li>
<li>ejbca提供的web service需要证书认证，证书格式：jks。对superadmin用户执行更新操作，修改“Token”值为“JKS file”<img src="https://i.imgur.com/2Za654a.png" alt=""></li>
<li>保存，然后按照下载普通用户证书的步骤下载superadmin的证书<h2 id="初始化web-service连接"><a href="#初始化web-service连接" class="headerlink" title="初始化web service连接"></a>初始化web service连接</h2></li>
<li><p>将web service所需的jar包添加到工程中，这些jar包是下面两个目录下的所以的jar.</p>
<blockquote>
</blockquote>
<pre><code>/opt/ca/ejbca-ce-6.3.1.1/dist/ejbca-ws-cli/lib
/opt/ca/ejbca-ce-6.3.1.1/dist/ejbca-ws-cli
</code></pre></li>
<li><p>初始化web service</p>
<blockquote>
<pre><code>public void init() {
    if (!new File(certPath).exists()) return;
    CryptoProviderTools.installBCProvider();
    System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;d:/superadmin.jks&quot;);
    System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;123456&quot;);
    System.setProperty(&quot;javax.net.ssl.keyStore&quot;, &quot;d:/superadmin.jks&quot;);
    System.setProperty(&quot;javax.net.ssl.keyStorePassword&quot;, &quot;123456&quot;);
    QName qname = new QName(&quot;http://ws.protocol.core.ejbca.org/&quot;, &quot;EjbcaWSService&quot;); 
    try {
        EjbcaWSService service = new EjbcaWSService(new URL(&quot;https://ca.xmyself.com:8443/ejbca/ejbcaws/ejbcaws?wsdl&quot;), qname);
        EjbcaWS ejbcaWS = service.getEjbcaWSPort();
    } catch (Exception e) {
    }
}
</code></pre></blockquote>
</li>
<li><p>注意：连接地址只能是域名，因此，连接ejbca的web service的机器要配置hosts<code>192.168.171.144 by.cos7</code></p>
<h2 id="数字证书管理"><a href="#数字证书管理" class="headerlink" title="数字证书管理"></a>数字证书管理</h2></li>
<li><p>查看用户是否已经注册</p>
<blockquote>
</blockquote>
<pre><code>private boolean isExist(String username) throws Exception {
    UserMatch usermatch = new UserMatch();
    usermatch.setMatchwith(UserMatch.MATCH_WITH_USERNAME);
    usermatch.setMatchtype(UserMatch.MATCH_TYPE_EQUALS);
    usermatch.setMatchvalue(username);
    try {
        List&lt;UserDataVOWS&gt; users = ejbcaWS.findUser(usermatch);
        if (users != null &amp;&amp; users.size() &gt; 0) {
            return true;
        } else {
            return false;
        }
    } catch (Exception e) {
        throw new Exception(&quot;检查用户 &quot; + username() + &quot; 是否存在时出错：&quot; + e.getMessage());
    }
}
</code></pre></li>
<li><p>用户注册与更新，用的都是editUser()方法，因此要先判断是否存在.</p>
<blockquote>
</blockquote>
<pre><code>public void editUser() throws Exception {
    UserDataVOWS userData = new UserDataVOWS();
    userData.setUsername(&quot;testname&quot;);//用户名
    userData.setPassword(&quot;123456&quot;);//密码
    userData.setClearPwd(false);//默认
    userData.setSubjectDN(&quot;CN=&quot; + &quot;testname&quot;
            + &quot;,OU=&quot; + &quot;testou&quot;
            + &quot;,O=&quot; + &quot;testo&quot;
            + &quot;,C=cn&quot;
            + &quot;,telephoneNumber=&quot; + &quot;1234567890&quot;
            );//设置唯一甄别名

    String pattern = &quot;yyyy-MM-dd HH:mm:ssZZ&quot;; // ISO 8601标准时间格式
    userData.setStartTime(DateFormatUtils.format(new Date(),pattern));//证书有效起始日期
    userData.setEndTime(DateFormatUtils.format(DateUtils.addDays(new Date(), 100), pattern));//结束日期

    userData.setCaName(&quot;test&quot;);//ca名称，ejbca的名称
    userData.setSubjectAltName(null);
    userData.setEmail(&quot;test@test.com&quot;);//邮件地址
    userData.setStatus(UserDataVOWS.STATUS_NEW);//状态为new
    userData.setTokenType(UserDataVOWS.TOKEN_TYPE_P12);//设置p12格式证书
    userData.setEndEntityProfileName(&quot;user&quot;);//终端实体模板
    userData.setCertificateProfileName(&quot;user&quot;);//证书模板
    try {
        ejbcaWS.editUser(userData);
    } catch (Exception e) {
        throw new Exception(e.getMessage());
    }
}
</code></pre></li>
<li><p>代码中有几处值得注意的，终端实体模板“user”和证书模板“user”需要在ejbca管理员界面中配置，并且终端实体模板“user”中要配置开启“SubjectDN”的属性如CN、OU、O、C、telephoneNumber等，还要允许修改startTime和endTime</p>
</li>
<li><p>吊销证书</p>
<blockquote>
</blockquote>
<pre><code>public void revoke(String username) throws ServiceException {
    try {
        ejbcaWS.revokeUser(username, RevokedCertInfo.REVOCATION_REASON_UNSPECIFIED, false);
    } catch (Exception e) {
    }
}    
</code></pre></li>
<li><p>创建证书</p>
<blockquote>
</blockquote>
<pre><code>private void createCert(String username, String password, String path) throws Exception {
    FileOutputStream fileOutputStream = null;
    try {
        // 创建证书文件
        KeyStore ksenv = ejbcaWS.pkcs12Req(username, password, null, &quot;2048&quot;, AlgorithmConstants.KEYALGORITHM_RSA);
        java.security.KeyStore ks = KeyStoreHelper.getKeyStore(ksenv.getKeystoreData(), &quot;PKCS12&quot;, password);
        fileOutputStream = new FileOutputStream(path + File.separator + username + &quot;.p12&quot;);
        ks.store(fileOutputStream, password.toCharArray());
        // 创建密码文件
        File pwdFile = new File(path + File.separator + username + &quot;.pwd&quot;);
        pwdFile.createNewFile();
        BufferedWriter out = new BufferedWriter(new FileWriter(pwdFile));
        out.write(password);
        out.flush();
        out.close();
    } catch (Exception e) {
        throw new Exception(&quot;用户  &quot; + username + &quot; 证书创建失败：&quot; + e.getMessage());
    } finally {
        if (fileOutputStream != null) {
            try {
                fileOutputStream.close();
            } catch (IOException e) {
            }
        }
    }
}        
</code></pre></li>
<li><p>证书创建在服务器上，用户调用下载证书的接口服务，返回下载地址，因此，这里需要一个下载服务器，下面介绍将nginx配置为下载服务器，文件存放的目录是/var/tmp + /download/</p>
<blockquote>
</blockquote>
<pre><code>location ^~ /download/{
    root   /var/tmp;
    if ($request_filename ~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx)$){
        add_header Content-Disposition: &apos;attachment;&apos;;
    }
}
</code></pre></li>
</ul>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><code>https://www.bbsmax.com/A/xl56xw2Yzr/</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/05/centos7搭建EJBCA环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/05/centos7搭建EJBCA环境/" itemprop="url">centos7搭建EJBCA环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-05T10:30:27+08:00">
                2018-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h1><h2 id="EJBCA说明"><a href="#EJBCA说明" class="headerlink" title="EJBCA说明"></a>EJBCA说明</h2><p>EJBCA是一个全功能的CA系统软件，它基于J2EE技术，并提供了一个强大的、高性能并基于组件的CA。EJBCA兼具灵活性和平台独立性，能够独立使用，也能和任何J2EE应用程序集成。</p>
<h2 id="EJBCA特性"><a href="#EJBCA特性" class="headerlink" title="EJBCA特性"></a>EJBCA特性</h2><ul>
<li>LGPL开源许可</li>
<li>建立在J2EE 1.3(EJB2.0)规范上</li>
<li>灵活的、基于组件的体系结构</li>
<li>多久CA</li>
<li>多个CA和多级CA,在一个EJBCA实例中创建一个或多个完整的基础设施单独运行，或者在任何J2EE应用中集成它</li>
<li>简单的安装和配置</li>
<li>强大的基于Web的管理界面，并采用了高强度的鉴别算法</li>
<li>支持基于命令的管理，并支持脚本等功能</li>
<li>支持个人证书申请或证书的批量生产</li>
<li>服务器和客户端证书能够采用PKCS12，JKS或者PEM格式导出</li>
<li>支持采用Netscape,Mozilla,IE等浏览器直接进行证书申请</li>
<li>支持使用开放的API和工具通过其他应用程序申请证书</li>
<li>由RA添加的新用户可以通过Email进行提醒</li>
<li>对于新用户验证可以采用随机或手工的方式生成密码</li>
<li>支持硬件模块，来集成硬件签发系统（如智能卡）</li>
<li>支持SCEP</li>
<li>支持用特定用户权限和用户组的方式来进行多极化管理</li>
<li>对不同类型和内容的证书可以进行证书配置</li>
<li>对不同类型的用户可以进行实体配置</li>
<li>遵循X509和PKIX（RFC3280）标准</li>
<li>支持CRL</li>
<li>完全支持OCSP,包括AIA扩展</li>
<li>CRL生成和基于URL的CRL分发遵循RFC3280,可以在任何SQL数据库中存储证书和CRL（通过应用服务器来处理）</li>
<li>可选的多个分发器，以用来在LDAP中发布证书和CRL</li>
<li>支持用来为指定用户和证书来恢复私钥的密钥恢复模块</li>
<li>基于组件的体系结构，用来在发布证书时采用多种实体授权方式</li>
<li>容易集成到大型应用程序中，并集成到业务流程进行了优化</li>
<li>EJBCA完全采用java编写，能够在任何采用J2EE服务器的平台上运行。开发和测试是在linux和Windows上进行的<h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="安装前的准备"><a href="#安装前的准备" class="headerlink" title="安装前的准备"></a>安装前的准备</h2></li>
<li>jdk-8u191-linux-x64.rpm[JDK1.8]</li>
<li>apache-ant-1.9.7-bin.tar.gz</li>
<li>jboss-eap-6.4.0-installer.jar</li>
<li>ejbca_ce_6_3_1_1.zip</li>
<li>mysql</li>
<li>mysql-connector-java-5.1.27.jar</li>
<li>centos7<h2 id="系统准备"><a href="#系统准备" class="headerlink" title="系统准备"></a>系统准备</h2><h3 id="安装JDK1-8"><a href="#安装JDK1-8" class="headerlink" title="安装JDK1.8"></a>安装JDK1.8</h3></li>
<li><p>检查已安装的jdk,如果有，先删除</p>
<blockquote>
</blockquote>
<pre><code>rpm -qa|grep java
rpm -e --nodeps filename
</code></pre></li>
<li><p>从<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html," title="jdk-8u191-linux-x64.rpm" target="_blank" rel="noopener">oracle官网](https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a>下载jdk安装包：<code>jdk-8u191-linux-x64.rpm</code>,放在/usr/file/目录下</p>
</li>
<li><p>用下面的命令安装，默认安装在/usr/java目录</p>
<blockquote>
</blockquote>
<pre><code>rpm -ivh jdk-8u191-linux-x64.rpm
</code></pre></li>
<li><p>配置环境变量</p>
<blockquote>
</blockquote>
<pre><code>vi /etc/profile
</code></pre></li>
<li><p>追加如下内容：</p>
<blockquote>
</blockquote>
<pre><code>#java conf
export JAVA_HOME=/usr/java/jdk1.8.0_191
export PATH=$PATH:$JAVA_HOME/bin
export CLASSPATH=:$JAVA_HOME/lib
</code></pre></li>
<li><p>使配置立即生效，然后检查安装结果</p>
<blockquote>
</blockquote>
<pre><code>source /etc/profile
java -version
</code></pre></li>
</ul>
<h3 id="安装ant"><a href="#安装ant" class="headerlink" title="安装ant"></a>安装ant</h3><ul>
<li><p>从<a href="https://archive.apache.org/dist/ant/binaries/," title="jdk-8u191-linux-x64.rpm" target="_blank" rel="noopener">ant官网</a>下载jdk安装包：<code>apache-ant-1.10.0-bin.tar.gz</code>,解压</p>
<blockquote>
</blockquote>
<pre><code>tar xvf apache-ant-1.10.0-bin.tar.gz -C /usr/java/
</code></pre></li>
<li><p>配置环境变量</p>
<blockquote>
</blockquote>
<pre><code>vi /etc/profile
</code></pre></li>
<li><p>追加如下内容：</p>
<blockquote>
</blockquote>
<pre><code>#ant conf
export ANT_HOME=/usr/java/apache-ant-1.10.0
export PATH=$PATH:$ANT_HOME/bin
</code></pre></li>
<li><p>使配置立即生效，然后检查安装结果</p>
<blockquote>
</blockquote>
<pre><code>source /etc/profile
ant -version
</code></pre></li>
</ul>
<h3 id="修改centos主机名"><a href="#修改centos主机名" class="headerlink" title="修改centos主机名"></a>修改centos主机名</h3><ul>
<li>参考:<code>https://www.jianshu.com/p/39d7000dfa47</code></li>
<li><p>要查看主机名相关的设置：</p>
<blockquote>
</blockquote>
<pre><code>[root@localhost ~]# hostnamectl
[root@localhost ~]# hostnamectl status
</code></pre></li>
<li><p>只查看静态、瞬态或灵活主机名，分别使用–static，–transient或–pretty选项</p>
<blockquote>
</blockquote>
<pre><code>[root@localhost ~]# hostnamectl --static
localhost.localdomain
[root@localhost ~]# hostnamectl --transient
localhost.localdomain
[root@localhost ~]# hostnamectl --pretty
</code></pre></li>
<li><p>要同时修改所有三个主机名：静态、瞬态和灵活主机名：</p>
<blockquote>
</blockquote>
<pre><code>[root@localhost ~]# hostnamectl set-hostname by.cos7
[root@localhost ~]# hostnamectl --pretty
[root@localhost ~]# hostnamectl --static
by.cos7
[root@localhost ~]# hostnamectl --transient
by.cos7
</code></pre></li>
<li><p>就像上面展示的那样，在修改静态/瞬态主机名时，任何特殊字符或空白字符会被移除，而提供的参数中的任何大写字母会自动转化为小写。<br>一旦修改了静态主机名，/etc/hostname 将被自动更新。然而，/etc/hosts 不会更新以保存所做的修改，所以你每次在修改主机名后一定要手动更新/etc/hosts，之后再重启CentOS 7。否则系统再启动时会很慢</p>
</li>
<li><p>手动更新/etc/hosts</p>
<blockquote>
</blockquote>
<pre><code>vim /etc/hosts
#127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
127.0.0.1  by.cos7
#::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
::1        by.cos7
</code></pre></li>
<li><p>重启CentOS 7 之后（reboot -f ）</p>
<blockquote>
</blockquote>
<pre><code>[root@by ~]# hostname
by.cos7
[root@by ~]# hostnamectl
</code></pre></li>
<li><p>如果你只想修改特定的主机名（静态，瞬态或灵活），你可以使用–static，–transient或–pretty选项。例如，要永久修改主机名，你可以修改静态主机名:</p>
<blockquote>
</blockquote>
<pre><code>[root@localhost ~]# hostnamectl --static set-hostname by.cos7
</code></pre></li>
<li><p>重启CentOS 7 之后（reboot -f ）</p>
<blockquote>
</blockquote>
<pre><code>[root@by ~]# hostnamectl --static
by.cos7
[root@by ~]# hostnamectl --transient
by.cos7
[root@by ~]# hostnamectl --pretty
by.cos7
[root@by ~]# hostname
by.cos7
</code></pre></li>
<li><p>其实，你不必重启机器以激活永久主机名修改。上面的命令会立即修改内核主机名。<br>注销并重新登入后在命令行提示来观察新的静态主机名</p>
<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3></li>
<li><p>安装前查看已安装的mysql或mysql库，并删除它们</p>
<blockquote>
</blockquote>
<pre><code>rpm -qa|grep -i mysql
rpm -e --nodeps filename
</code></pre></li>
<li><p>如果重装mysql，查找安装mysql产生的文件，并删除它们</p>
<blockquote>
</blockquote>
<pre><code>find / -name mysql
rm -fr filename
</code></pre></li>
<li><p>CentOS7的yum源中默认好像是没有mysql的。为了解决这个问题，我们要先下载mysql的repo源</p>
<blockquote>
</blockquote>
<pre><code>$ wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm
</code></pre></li>
<li><p>安装mysql-community-release-el7-5.noarch.rpm包</p>
<blockquote>
</blockquote>
<pre><code>$ sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm
</code></pre></li>
<li><p>安装这个包后，会获得两个mysql的yum repo源：/etc/yum.repos.d/mysql-community.repo，/etc/yum.repos.d/mysql-community-source.repo</p>
</li>
<li><p>安装mysql</p>
<blockquote>
</blockquote>
<pre><code>$ sudo yum install mysql-server
</code></pre></li>
<li><p>如果yum正在使用：强制关闭yum命令<code>rm -f /var/run/yum.pid</code></p>
</li>
<li><p>重置密码,重置密码前，首先要登录</p>
<blockquote>
</blockquote>
<pre><code>$ mysql -u root
</code></pre></li>
<li><p>登录时有可能报这样的错：ERROR 2002 (HY000): Can‘t connect to local MySQL server through socket ‘/var/lib/mysql/mysql.sock‘ (2)，原因是/var/lib/mysql的访问权限问题。下面的命令把/var/lib/mysql的拥有者改为当前用户：</p>
<blockquote>
</blockquote>
<pre><code>$ sudo chown -R mysql:mysql /var/lib/mysql
</code></pre></li>
<li><p>然后，重启服务：</p>
<blockquote>
</blockquote>
<pre><code>$ service mysqld restart
</code></pre></li>
<li><p>接下来登录重置密码：</p>
<blockquote>
</blockquote>
<pre><code>$ mysql -u root
mysql &gt; use mysql;
mysql &gt; update user set password=password(&apos;123456&apos;) where user=&apos;root&apos;;
mysql &gt; exit;
</code></pre></li>
<li><p>需要更改权限才能实现远程连接MYSQL数据库</p>
<blockquote>
</blockquote>
<pre><code># mysql -uroot -p
Enter password: ******
mysql&gt; use mysql; (此DB存放MySQL的各种配置信息)
Database changed
mysql&gt; select host,user from user; (查看用户的权限情况)
mysql&gt; select host, user, password from user;
+-----------+------+-------------------------------------------+
| host       | user | password                                   |
+-----------+------+-------------------------------------------+
| localhost | root | *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| 127.0.0.1 | root | *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| localhost |       |                                            |
+-----------+------+-------------------------------------------+
4 rows in set (0.01 sec)
由此可以看出，只能以localhost的主机方式访问。
解决方法：
mysql&gt; Grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;123456&apos; with grant option;
(%表示是所有的外部机器，如果指定某一台机，就将%改为相应的机器名；‘root’则是指要使用的用户名，)
mysql&gt; flush privileges;    (运行此句才生效，或者重启MySQL)
Query OK, 0 rows affected (0.03 sec)
再次查看。。
mysql&gt; select host, user, password from user;
+-----------+------+-------------------------------------------+
| host       | user | password                                   |
+-----------+------+-------------------------------------------+
| localhost | root | *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| 127.0.0.1 | root | *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| localhost |       |                                            |
| %          | root | *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
+-----------+------+-------------------------------------------+
4 rows in set (0.01 sec)
</code></pre></li>
</ul>
<h3 id="创建ejbca数据库"><a href="#创建ejbca数据库" class="headerlink" title="创建ejbca数据库"></a>创建ejbca数据库</h3><ul>
<li><p>建数据库：</p>
<blockquote>
</blockquote>
<pre><code>CREATE DATABASE ejbca CHARACTER SET utf8 COLLATE utf8_general_ci;
</code></pre></li>
<li><p>本机连接centos7中的数据库</p>
<blockquote>
</blockquote>
<pre><code>vmware-&gt;编辑-&gt;虚拟网络编辑器-&gt;vmnet8-&gt;NAT设置-&gt;将虚拟ip地址加上（如80 192.168.171.143：80 TCP）
关闭防火墙：
[root@by ~]# systemctl stop firewalld.service
本机hosts文件（windows/system32/drivers/etc/hosts）配置：
192.168.171.144  by.cos7
</code></pre></li>
</ul>
<h3 id="为EJBCA新建用户"><a href="#为EJBCA新建用户" class="headerlink" title="为EJBCA新建用户"></a>为EJBCA新建用户</h3><ul>
<li><p>进入root用户(su命令)：(设置pwd:ejbca)</p>
<blockquote>
</blockquote>
<pre><code>adduser ca
passwd ca
</code></pre></li>
<li><p>将安装包的所有者改成ca</p>
<blockquote>
</blockquote>
<pre><code>mkdir /opt/ca/
chown ca:ca /opt/ca
chown ca:ca /opt/ca/jboss-eap-6.4.0-installer.jar
chown ca:ca /opt/ca/ejbca_ce_6_3_1_1.zip
chown ca:ca /opt/ca/mysql-connector-java-5.1.27.jar
</code></pre></li>
</ul>
<h2 id="安装JBoss-EAP"><a href="#安装JBoss-EAP" class="headerlink" title="安装JBoss EAP"></a>安装JBoss EAP</h2><ul>
<li>切换用户: <code>su ca</code></li>
<li><p>用java命令安装JBoss EAP：</p>
<blockquote>
</blockquote>
<pre><code>java -jar /opt/ca/jboss-eap-6.4.0-installer.jar
</code></pre></li>
<li><p>安装过程会有交互：</p>
<blockquote>
</blockquote>
<pre><code>#选择安装语言，默认为英语
Select language  :
0:  eng
1:  chn
2:  deu
3:  fra
4:  jpn
5:  por
6:  spa
Please choose  [0]  :

#确认协议之后是安装路径，默认即可
Select the installation path:  [/root/EAP-6.4.0]

#随后是部件选项，默认即可
Select the packs you want to  install:

1    [x]  [Required]      [Red Hat JBoss Enterprise Application Platform]  (542.89  KB)
2    [x] [AppClient]  (34.24  KB)
3    [x]  [Required]      [Bin]  (10.99  MB)
4    [x]  [Required]      [Bundles]  (1.01  MB)
5    [x] [Docs]  (4.75  MB)
6    [x]  [Required]      [Domain]  (125.56  KB)
7    [x]  [Required]      [Domain Shell Scripts]  (17.35  KB)
8    [x]  [Required]      [Modules]  (147.01  MB)
9    [x]  [Required]      [Standalone]  (152.77  KB)
10 [x]  [Required]      [Standalone Shell Scripts]  (14.16  KB)
11 [x]  [Required]      [Welcome Content]  (2.11  MB)
12 [x] [Red Hat JBoss Enterprise Application Platform Natives]  (8  KB)
13 [x] [Native RHEL7 x86_64]  (76  KB)
14 [x] [Native Utils RHEL7 x86_64]  (53.04  KB)
15 [x] [Native Webserver RHEL7 x86_64]  (254.97  KB)
Total Size Required:  167.11  MB
Press  0  to  confirm your selections
Please select which packs you want to  install

#随后是jboss用户名和密码（admin:jbossadmin5*）
Admin username:  [admin]
Admin password:  []
*************
Confirm admin password:  [*************]
*************
press  1  to  continue,  2  to  quit,  3  to  redisplay.

#然后是演示文件的安装，我选择no
Quickstarts
Red Hat JBoss Enterprise Application Platform comes with  a  series of quickstart examples designed to  help users begin writing applications using the Java EE  6  technologies.  Would you like to  install quickstarts?
0  [x]  No
1  [  ]  Yes

#最后是监听端口，默认是8080,
Socket Bindings
Configure the socket bindings for  Red Hat JBoss Enterprise Application Platform.
Select Port Configuration:
0  [x]  Use  the default  port bindings for  standalone and  domain modes.
1  [  ]  Configure an offset for  all default  port bindings.
2  [  ]  Configure custom port bindings.

#紧接着是是否启用IPv6
If  this  computer is  using  a  pure IPv6 configuration,  please check the box below.
  [  ]  Enable pure IPv6 configuration

#然后会询问是否启动服务器，先不启动
Server Launch
Choose server startup mode:
0  [x]  Don&apos;t  start the server
1  [  ]  Standalone Mode
2  [  ]  Domain Mode

#选择日志等级
Configure the logging levels for  Red Hat JBoss Enterprise Application Platform?
0  [x]  No
1  [  ]  Yes
#选择配置文件
Configure runtime environment
There are several additional options for  configuring Red Hat JBoss Enterprise Application Platform now that the server has been installed.  Each  option can be individually chosen,  and  will be configured in  the order displayed upon pressing next.  Would you like to  do  this  now?
0  [x]  Perform default  configuration
1  [  ]  Perform advanced configuration
</code></pre></li>
<li><p>经过一系列交互之后就会解包安装：<img src="https://i.imgur.com/eqaXqq5.jpg" alt=""></p>
</li>
<li><p>到这里已经完成JBoss EAP的安装，其实他有个基于web的控制面饭，但是服务器只监听127.0.0.1这个IP，如果需要监听其他IP或0.0.0.0，请修改以下文件：</p>
<blockquote>
</blockquote>
<pre><code>#打开文件进行修改
[root@ejbca  ~]# vim /opt/ca/EAP-6.4.0/standalone/configuration/standalone.xml
搜索：/127.0.0.1
#定位到interface的节点和该节点上面的127.0.0.1，修改监听地址为0.0.0.0
&lt;interfaces&gt;
    &lt;interface  name=&quot;management&quot;&gt;
        &lt;inet-address value=&quot;${jboss.bind.address.management:0.0.0.0}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface  name=&quot;public&quot;&gt;
        &lt;inet-address value=&quot;${jboss.bind.address:0.0.0.0}&quot;/&gt;
    &lt;/interface&gt;
    &lt;!--  TODO  -  only show this  if  the jacorb subsystem is  added  --&gt;
    &lt;interface  name=&quot;unsecure&quot;&gt;
        &lt;!--
          ~  Used for  IIOP sockets in  the standard configuration.
          ~                  To  secure JacORB you need to  setup SSL
          --&gt;
        &lt;inet-address value=&quot;${jboss.bind.address.unsecure:0.0.0.0}&quot;/&gt;
    &lt;/interface&gt;
&lt;/interfaces&gt;    
</code></pre></li>
<li><p>随后使用以下命令启动服务，在这里先不用脚本，因为后面需要重启服务。启动服务后再打开一个SSH窗口进行下面的步骤：</p>
<blockquote>
</blockquote>
<pre><code>[root@ejbca  ~]# /opt/ca/EAP-6.4.0/bin/standalone.sh
（ps:此处不会用）顺便记一下关闭服务的命令：ctrl+c或者如下：
ps -ef|grep jboss
kill -9 进程号
</code></pre></li>
<li><p>确认JBoss EAP服务启动后即可通过浏览器打开管理界面：访问http:by.cos7:8080/</p>
<h2 id="配置jboss的mysql数据源"><a href="#配置jboss的mysql数据源" class="headerlink" title="配置jboss的mysql数据源"></a>配置jboss的mysql数据源</h2></li>
<li><p>创建目录，然后在该目录下创建module.xml</p>
<blockquote>
</blockquote>
<pre><code>mkdir -p /opt/ca/EAP-6.4.0/modules/com/mysql/main/
cd /opt/ca/EAP-6.4.0/modules/com/mysql/main
vi module.xml
</code></pre></li>
<li><p>module.xml内容如下：</p>
<blockquote>
</blockquote>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;com.mysql&quot;&gt;
    &lt;resources&gt;
        &lt;resource-root path=&quot;mysql-connector-java-5.1.27.jar&quot;/&gt;
    &lt;/resources&gt;
    &lt;dependencies&gt;
        &lt;module name=&quot;javax.api&quot;/&gt;
        &lt;module name=&quot;javax.transaction.api&quot;/&gt;
        &lt;module name=&quot;org.slf4j&quot;/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;
</code></pre></li>
<li><p>将mysql的驱动包<code>mysql-connector-java-5.1.27.jar</code>，拷贝到当前目录xxx/mian</p>
<blockquote>
</blockquote>
<pre><code>cp /home/ca/Downloads/mysql-connector-java-5.1.27.jar ./
</code></pre></li>
<li><p>打开新的shell窗口，运行</p>
<blockquote>
</blockquote>
<pre><code>[root@by EAP-6.4.0]# /opt/ca/EAP-6.4.0/bin/jboss-cli.sh
You are disconnected at  the moment.  Type  &apos;connect&apos;  to  connect to  the server or  &apos;help&apos;  for  the list of supported commands.
[disconnected  /]
</code></pre></li>
<li><p>如果提示disconnected，则需要输入connect并回车，如果一切正常则显示：</p>
<blockquote>
</blockquote>
<pre><code>[standalone@localhost:9999  /]
</code></pre></li>
<li><p>然后输入以下命令在JBoss中注册mysql驱动：</p>
<blockquote>
</blockquote>
<pre><code>#注册驱动
/subsystem=datasources/jdbc-driver=com.mysql.jdbc.Driver:add(driver-name=com.mysql.jdbc.Driver,driver-class-name=com.mysql.jdbc.Driver,driver-module-name=com.mysql,driver-xa-datasource-class-name=com.mysql.jdbc.jdbc.jdbc2.optional.MysqlXADataSource)
#重新加载
:reload
</code></pre></li>
<li><p>完成后输入exit回车即可退出。</p>
<h2 id="安装ejbca"><a href="#安装ejbca" class="headerlink" title="安装ejbca"></a>安装ejbca</h2></li>
<li><p>　从ejbca官方网站下载ejbca安装包：ejbca_ce_6_3_1_1.zip，放在/usr/file目录，解压，准备修改配置</p>
<blockquote>
</blockquote>
<pre><code>unzip /usr/file/ejbca_ce_6_3_1_1.zip -d /usr/java
cd /usr/java
mv ejbca_ce_6_3_1_1 ejbca-ce-6.3.1.1
cd /usr/java/ejbca-ce-6.3.1.1/conf/
# 配置文件目录包含以下文件：
ll -h
</code></pre></li>
<li><p>EJBCA只加载后缀名为properties的文件，否则则加载默认配置。在这里我们需要修改以下文件：</p>
<blockquote>
</blockquote>
<pre><code>database.properties：数据库配置文件
ejbca.properties：EJBCA配置文件
install.properties：安装配置文件
web.properties：web服务配置文件
</code></pre></li>
<li><p>首先是数据库配置文件，先将文件复制一份然后进行修改:</p>
<blockquote>
</blockquote>
<pre><code># 复制
cp database.properties.sample database.properties
# 修改
vim database.properties
# 修改以下内容
datasource.jndi-name=jboss/datasources/MySqlDS
database.name=mysql
database.url=jdbc:mysql://by.cos7:3306/ejbca?characterEncoding=UTF-8
database.driver=org.mysql.jdbc.Driver
database.username=root
database.password=123456
</code></pre></li>
<li><p>然后复制并修改EJBCA配置文件:</p>
<blockquote>
</blockquote>
<pre><code># 复制
cp ejbca.properties.sample ejbca.properties
# 修改
vim ejbca.properties
# 修改以下内容
appserver.home=/opt/ca/EAP-6.4.0
appserver.type=jboss
approval.defaultrequestvalidity=28800 #保持默认状态
approval.defaultapprovalvalidity=28800 #保持默认状态
ejbca.passwordlogrounds=8 #设置密码为8位
</code></pre></li>
<li><p>然后修改安装配置文件：</p>
<blockquote>
</blockquote>
<pre><code># 复制
cp install.properties.sample install.properties
# 修改
vim install.properties
# 修改以下内容
ca.name=EnginxManagementCA
ca.dn=CN=TestManagementCA,O=Test,C=CN
ca.tokentype=soft
ca.tokenpassword=null
ca.keyspec=4096
ca.keytype=RSA
ca.signaturealgorithm=SHA256WithRSA
ca.validity=3650
ca.policy=null
ca.certificateprofile=ROOTCA #要修改
</code></pre></li>
<li><p>最后是web服务配置文件：</p>
<blockquote>
</blockquote>
<pre><code># 复制
cp web.properties.sample web.properties
# 修改
vim web.properties
# 修改以下内容
java.trustpassword=changeit  #默认即可
superadmin.cn=SuperAdmin  #默认即可
superadmin.dn=CN=${superadmin.cn},O=Test,C=CN
superadmin.password=ejbca  #默认即可
superadmin.batch=true
httpsserver.password=serverpwd  #默认即可
httpsserver.hostname=by.cos7
httpsserver.dn=CN=${httpsserver.hostname},O=Test,C=CN
httpserver.pubhttp=8080 #不修改
httpserver.pubhttps=8442 #不修改
httpserver.privhttps=8443 #不修改
</code></pre><h2 id="部署ejbca到jboss"><a href="#部署ejbca到jboss" class="headerlink" title="部署ejbca到jboss"></a>部署ejbca到jboss</h2></li>
<li>deploy用ant部署，install生成证书，deploy-keystore将证书部署到jboss，前两步所需时间较长，过程中如需输入，请直接回车:<blockquote>
</blockquote>
<pre><code>cd /opt/ca/ejbca-ce-6.3.1.1
ant clean deploy
ant install #成功后会生成数据库表
ant deploy-keystore
</code></pre><h2 id="配置jboss的https"><a href="#配置jboss的https" class="headerlink" title="配置jboss的https"></a>配置jboss的https</h2></li>
<li><p>打开新的shell窗口，运行</p>
<blockquote>
</blockquote>
<pre><code>/opt/ca/EAP-6.4.0/bin/jboss-cli.sh
如果是“disconnect”状态，运行“connect”，多回车几次，准备运行下面4部分配置
</code></pre></li>
<li><p>第一部分（配置任意主机可访问）</p>
<blockquote>
</blockquote>
<pre><code>/interface=http:add(inet-address=&quot;0.0.0.0&quot;)
/interface=httpspub:add(inet-address=&quot;0.0.0.0&quot;)
/interface=httpspriv:add(inet-address=&quot;0.0.0.0&quot;)
/socket-binding-group=standard-sockets/socket-binding=http:add(port=&quot;8080&quot;,interface=&quot;http&quot;)
/subsystem=undertow/server=default-server/http-listener=http:add(socket-binding=http)
/subsystem=undertow/server=default-server/http-listener=http:write-attribute(name=redirect-socket, value=&quot;httpspriv&quot;)
:reload
</code></pre></li>
<li><p>第二部分（配置证书））</p>
<blockquote>
</blockquote>
<pre><code>/core-service=management/security-realm=SSLRealm:add()
/core-service=management/security-realm=SSLRealm/server-identity=ssl:add(keystore-path=&quot;${jboss.server.config.dir}/keystore/keystore.jks&quot;, keystore-password=&quot;serverpwd&quot;, alias=&quot;prod-ica1&quot;)
/core-service=management/security-realm=SSLRealm/authentication=truststore:add(keystore-path=&quot;${jboss.server.config.dir}/keystore/truststore.jks&quot;, keystore-password=&quot;changeit&quot;)
/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port=&quot;8443&quot;,interface=&quot;httpspriv&quot;)
/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port=&quot;8442&quot;, interface=&quot;httpspub&quot;)
:reload
</code></pre></li>
</ul>
<ul>
<li><p>第三部分（配置ssl））</p>
<blockquote>
</blockquote>
<pre><code>/subsystem=undertow/server=default-server/https-listener=httpspriv:add(socket-binding=httpspriv, security-realm=&quot;SSLRealm&quot;, verify-client=REQUIRED)
/subsystem=undertow/server=default-server/https-listener=httpspub:add(socket-binding=httpspub, security-realm=&quot;SSLRealm&quot;)
:reload
</code></pre></li>
<li><p>第四部分（配置web service）</p>
<blockquote>
</blockquote>
<pre><code>/system-property=org.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH:add(value=true)
/system-property=org.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH:add(value=true)
/system-property=org.apache.catalina.connector.URI_ENCODING:add(value=&quot;UTF-8&quot;)
/system-property=org.apache.catalina.connector.USE_BODY_ENCODING_FOR_QUERY_STRING:add(value=true)
/subsystem=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)
/subsystem=webservices:write-attribute(name=modify-wsdl-address, value=true)
:reload
</code></pre></li>
</ul>
<h2 id="使用ejbca-community-6-3-1-1"><a href="#使用ejbca-community-6-3-1-1" class="headerlink" title="使用ejbca community 6.3.1.1"></a>使用ejbca community 6.3.1.1</h2><ul>
<li>假设ejbca服务器地址：172.17.210.124，编辑windows的“C:\Windows\System32\drivers\etc”下的hosts文件，加入一行<code>172.17.210.124 by.cos7</code></li>
<li>拷贝ejbca服务器“/usr/java/ejbca-ce-6.3.1.1/p12/”下的superadmin.p12到windows，双击安装，密码“ejbca”,ejbca提供了两个界面</li>
<li>用户界面:<code>http://by.cos7:8080/ejbca/</code></li>
<li>管理员界面（需要证书，使用刚才安装的superadmin证书）:<code>https://by.cos7:8443/ejbca/adminweb/</code></li>
<li>图片参考：<img src="https://i.imgur.com/10L0sEU.jpg" alt=""><img src="https://i.imgur.com/1hKKnKm.jpg" alt=""><img src="https://i.imgur.com/TvEsmb5.jpg" alt=""><img src="https://i.imgur.com/jizg2OD.png" alt=""><img src="https://i.imgur.com/4SjRPld.png" alt=""><h1 id="三、参考链接"><a href="#三、参考链接" class="headerlink" title="三、参考链接"></a>三、参考链接</h1></li>
<li><code>https://www.jianshu.com/p/56051594fee9</code></li>
<li><code>https://www.bbsmax.com/A/xl56xw2Yzr/</code></li>
<li><code>https://piggsoft.com/2018/07/11/PKI%E4%BD%93%E7%B3%BB%EF%BC%88%E4%B8%89%EF%BC%89-EJBCA%E5%AE%89%E8%A3%85/</code></li>
<li>(centos7安装mysql)<code>https://www.cnblogs.com/julyme/p/5969626.html</code></li>
<li>(centos改主机名)<code>https://www.jianshu.com/p/39d7000dfa47</code></li>
<li>(EJBCA下载)<code>https://www.ejbca.org/download.html</code></li>
<li>(JBoss EAP) <code>https://developers.redhat.com/products/eap/download/)</code>6.4.0</li>
<li>(JDK下载)<code>https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</code></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/25/(五)spring-cloud进阶四/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/25/(五)spring-cloud进阶四/" itemprop="url">(五)spring cloud进阶四——断路器(Hystrix)(Finchley版本)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-25T14:44:28+08:00">
                2018-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="断路器-Hystrix-Finchley版本"><a href="#断路器-Hystrix-Finchley版本" class="headerlink" title="断路器(Hystrix)(Finchley版本)"></a>断路器(Hystrix)(Finchley版本)</h1><ul>
<li>在微服务架构中，根据业务来拆分成一个个的服务，服务与服务间可以相互调用(RPC)，在spring cloud可以用RestTemplate+Ribbon和Feign来调用服务。为了保证其高可用，单个服务通常会集群部署。但由于网络或自身原因，服务并不能保证100%可用，如果单个服务出现了问题，调用服务就会出现线程阻塞，此时若有大量的请求涌入，Servlet容器的线程资源就会被消耗完毕，导致服务瘫痪，因为服务与服务之间的依赖性，故障会传播，会对整个微服务系统造成灾难性的严重后果，这就是服务故障的“雪崩”效应。</li>
<li>为了解决这个问题，业界提出了断路器模型：<img src="https://i.imgur.com/Ij52NVO.png" alt=""><img src="https://i.imgur.com/QaS6wog.png" alt=""></li>
<li>启动eureka-server工程；启动service-hi工程，它的端口为9873。<h1 id="在ribbon中使用断路器"><a href="#在ribbon中使用断路器" class="headerlink" title="在ribbon中使用断路器"></a>在ribbon中使用断路器</h1>改造service-ribbon工程的代码<h2 id="添加hystrix的依赖"><a href="#添加hystrix的依赖" class="headerlink" title="添加hystrix的依赖"></a>添加hystrix的依赖</h2></li>
<li>添加依赖：spring-cloud-starter-netflix-hystrix<img src="https://i.imgur.com/jFUVvZj.png" alt=""><h2 id="在启动类开启断路器"><a href="#在启动类开启断路器" class="headerlink" title="在启动类开启断路器"></a>在启动类开启断路器</h2></li>
<li>在启动类添加@EnableHystrix注解，开启断路器的功能，用于控制servlet容器的线程阻塞。<img src="https://i.imgur.com/9CE0Zr1.png" alt=""><h2 id="改造HelloService类"><a href="#改造HelloService类" class="headerlink" title="改造HelloService类"></a>改造HelloService类</h2></li>
<li>改造HelloService类，在hiService方法上加上@HystrixCommand注解，该注解为该方法创建了熔断器功能，并指定了fallbackMethod熔断方法，此处的熔断方法直接返回一个字符串。<img src="https://i.imgur.com/uyeUM43.png" alt=""><h2 id="启动service-ribbon工程"><a href="#启动service-ribbon工程" class="headerlink" title="启动service-ribbon工程"></a>启动service-ribbon工程</h2></li>
<li>访问：localhost:9871/hi?name=qinhs</li>
<li>浏览器显示（注意，若service-hi服务正常启动，该服务的/hi接口能正常访问）：<img src="https://i.imgur.com/yPDUy1l.png" alt="">【ps:该图片是service-hi服务正常启动时】</li>
<li>关闭service-hi：当service-hi服务不可用时（如未正常启动），service-ribbon调用service-hi的API接口时，会执行快速失败，直接调用熔断方法（返回字符串），而不是等待响应超时，这就很好地控制了容器地线程阻塞。<img src="https://i.imgur.com/jcMva5H.png" alt=""><h1 id="在feign使用断路器"><a href="#在feign使用断路器" class="headerlink" title="在feign使用断路器"></a>在feign使用断路器</h1></li>
<li>feign是自带断路器的，在D版本的Spring cloud之后，它没有默认打开。需要在配饰文件中配置打开它，在配置文件加以下代码：<blockquote>
<p>dd</p>
<pre><code>feign hystrix enabled=true
</code></pre></blockquote>
</li>
</ul>
<h2 id="改造service-feign工程"><a href="#改造service-feign工程" class="headerlink" title="改造service-feign工程"></a>改造service-feign工程</h2><ul>
<li>Feign自带断路器，只需要在FeignClient的schedualServiceHi（定义的Feign接口）接口的注解（@FeignClient注解）中加上fallback的指定类就行了：<img src="https://i.imgur.com/7O2ryir.png" alt=""></li>
<li>注意：SchedualServiceHiHystriclmpl类要实现SchedualserviceHi接口，并使用@Component注解：<img src="https://i.imgur.com/iVcpoDE.png" alt=""><h2 id="启动service-feign工程"><a href="#启动service-feign工程" class="headerlink" title="启动service-feign工程"></a>启动service-feign工程</h2></li>
<li>此时没有启动service-hi工程，启动service-feign工程，出现超时问题：<img src="https://i.imgur.com/wPLnk7B.png" alt=""></li>
<li>解决办法：真正原因是忘了加@Component注解，断路器指定的返回方法找不到：<img src="https://i.imgur.com/iFp2SWu.png" alt=""><img src="https://i.imgur.com/KmfmWRm.png" alt=""></li>
<li>启动service-hi工程后（证明熔断器起到了作用）<img src="https://i.imgur.com/LNKpPas.png" alt=""></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/(四)spring-cloud进阶三/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/(四)spring-cloud进阶三/" itemprop="url">(四)spring cloud进阶三——服务消费者（feign）(Finchley版本)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T15:47:59+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="服务消费者（Feign）-Finchley版本"><a href="#服务消费者（Feign）-Finchley版本" class="headerlink" title="服务消费者（Feign）(Finchley版本)"></a>服务消费者（Feign）(Finchley版本)</h1><ul>
<li>Feign是一个声明式的伪Http客户端，它使得写http客户端变得更简单。使用feign,只需要创建一个接口并注解。它具有可插拔的注解特性，可使用Feign注解和JAX-RS注解。Feign支持可插拔的编码器和解码器。Feign默认集成了Ribbon，并和Eureka结合，默认实现了负载均衡的效果。</li>
<li>和上个教程一样，启动两个service-hi工程的实例【9873，9872端口】<h1 id="创建一个Feign的服务"><a href="#创建一个Feign的服务" class="headerlink" title="创建一个Feign的服务"></a>创建一个Feign的服务</h1><h2 id="创建一个spring-boot项目（module）"><a href="#创建一个spring-boot项目（module）" class="headerlink" title="创建一个spring boot项目（module）"></a>创建一个spring boot项目（module）</h2></li>
<li>参照上个教程的创建方法<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2></li>
<li>注意依赖名称，新版本：openfeign;老版本：feign<img src="https://i.imgur.com/TbyXNZe.png" alt=""><h2 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h2></li>
<li>配置文件application.yml<img src="https://i.imgur.com/x6Amdxw.png" alt=""><h2 id="在启动类开启feign的功能"><a href="#在启动类开启feign的功能" class="headerlink" title="在启动类开启feign的功能"></a>在启动类开启feign的功能</h2></li>
<li>在工程的启动类ServiceFeignApplication，加上@EnableFeignClients注解开启Feign的功能。<img src="https://i.imgur.com/44FKnjL.png" alt=""><h2 id="定义feign接口调用其他服务"><a href="#定义feign接口调用其他服务" class="headerlink" title="定义feign接口调用其他服务"></a>定义feign接口调用其他服务</h2></li>
<li>定义一个Feign接口，通过@FeignClient（“服务名”），来指定调用哪个服务，比如在代码中调用了service-hi服务的“hi”接口：(注意，只用定义接口，消费的是其他服务)。<img src="https://i.imgur.com/BcnyNnf.png" alt=""><h2 id="在controller层对外暴露api接口"><a href="#在controller层对外暴露api接口" class="headerlink" title="在controller层对外暴露api接口"></a>在controller层对外暴露api接口</h2></li>
<li>在web层的controller层，对外暴露一个“/hi”的API接口，通过上面定义的Feign客户端SchedualServiceHi来消费服务。<img src="https://i.imgur.com/gVTSL9a.png" alt=""></li>
<li>启动程序，运行结果：<img src="https://i.imgur.com/KTxBBmM.png" alt=""></li>
<li>结果是浏览器交替显示，即做了负载均衡，交替消费两个运行的实例，与上个教程的效果一致。</li>
<li><img src="https://i.imgur.com/AwlTkSg.png" alt="">刷新后：<img src="https://i.imgur.com/QlzLi6X.png" alt=""></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/(三)spring-cloud进阶二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/(三)spring-cloud进阶二/" itemprop="url">(三)spring-cloud进阶二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T10:43:53+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="服务消费者（rest-ribbon）-Finchley版本"><a href="#服务消费者（rest-ribbon）-Finchley版本" class="headerlink" title="服务消费者（rest+ribbon）(Finchley版本)"></a>服务消费者（rest+ribbon）(Finchley版本)</h1><p>参考：<a href="https://blog.csdn.net/forezp/article/details/81040946" title="rest+ribbon(Finchley版本)" target="_blank" rel="noopener">https://blog.csdn.net/forezp/article/details/81040946</a></p>
<ul>
<li>在微服务架构中，业务都会被拆分成一个独立的服务，服务与服务的通讯是基于http restful的。spring cloud有两种服务调用方式，一种是ribbon+restTemplate,另一种是feign。</li>
<li>Ribbon用于负载均衡</li>
<li>RestTemplate用于消费其他服务提供的接口<h1 id="在IEDA下启动多个实例"><a href="#在IEDA下启动多个实例" class="headerlink" title="在IEDA下启动多个实例"></a>在IEDA下启动多个实例</h1>参考：<a href="https://blog.csdn.net/forezp/article/details/76408139" title="idea下启动多个实例" target="_blank" rel="noopener">https://blog.csdn.net/forezp/article/details/76408139</a></li>
<li>启动eureka-server工程</li>
<li>启动service-hi工程【启动了一个实例】</li>
<li>修改service-hi工程的端口（在配置文件中修改），并启动【启动了另一个实例】</li>
<li>会发现service-hi在eureka-server注册了2个实例，这就相当于一个小的集群。</li>
<li>图解：<img src="https://i.imgur.com/XJx2OR2.png" alt=""><img src="https://i.imgur.com/GobY1oP.png" alt=""><img src="https://i.imgur.com/v79UfEW.png" alt=""><img src="https://i.imgur.com/iX5oAMH.png" alt=""><img src="https://i.imgur.com/pTETbLr.png" alt=""><h2 id="建一个服务消费者"><a href="#建一个服务消费者" class="headerlink" title="建一个服务消费者"></a>建一个服务消费者</h2><h3 id="创建一个spring-boot项目（module）"><a href="#创建一个spring-boot项目（module）" class="headerlink" title="创建一个spring boot项目（module）"></a>创建一个spring boot项目（module）</h3></li>
<li><img src="https://i.imgur.com/EhST8GI.png" alt=""><img src="https://i.imgur.com/j4dOGtv.png" alt=""><img src="https://i.imgur.com/OG29a66.png" alt=""><img src="https://i.imgur.com/jvRD3Hk.png" alt=""><img src="https://i.imgur.com/ukxfFVg.png" alt=""><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3></li>
<li><img src="https://i.imgur.com/oytjbRQ.png" alt=""><img src="https://i.imgur.com/He0oPuC.png" alt=""><h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3></li>
<li><img src="https://i.imgur.com/TEPnDff.png" alt=""><h3 id="在启动类向服务中心注册"><a href="#在启动类向服务中心注册" class="headerlink" title="在启动类向服务中心注册"></a>在启动类向服务中心注册</h3></li>
<li>在工程的启动类中，通过@EnableDiscoveryClient向服务注册中心注册，并且向程序的ioc注入一个bean:restTemplate;并且通过@LoadBalanced注解表明这个restTemplate开启负载均衡的功能。</li>
<li>此处注意：spring boot注入restTemplate的方式。<ol>
<li>直接在启动类用new RestTemplate()方式实例化restTemplate(如下图一所示)。</li>
<li>spring boot自动注入了RestTemplateBuilder的实例，利用builder.buid()方法实例化一个RestTemplate对象（如下图二和三所示）。</li>
<li><img src="https://i.imgur.com/L8oV8Cg.png" alt=""><img src="https://i.imgur.com/E7XnZc9.png" alt=""><img src="https://i.imgur.com/getFM2R.png" alt=""><h3 id="通过restTemplate来消费其他服务的接口"><a href="#通过restTemplate来消费其他服务的接口" class="headerlink" title="通过restTemplate来消费其他服务的接口"></a>通过restTemplate来消费其他服务的接口</h3></li>
</ol>
</li>
<li>编写测试类HelloService，通过之前注入的ioc的restTemplate来消费service-hi服务的”/hi”接口，此处直接用程序名替代了具体的url地址，在ribbon中它会根据服务名（前提是restTemplate加了负载均衡的注解@Loadbalanced）选着具体的服务实例，根据服务实例在请求的时候会用具体的url替换掉服务名。</li>
<li><img src="https://i.imgur.com/YywSlFk.png" alt=""><img src="https://i.imgur.com/aaDmO6i.png" alt=""></li>
<li>运行结果：<img src="https://i.imgur.com/LFk4sL2.png" alt=""><img src="https://i.imgur.com/T5BLAq9.png" alt=""></li>
<li>刷新后：浏览器交替显示，说明调用restTemplate.getForObject(“<a href="http://SERVICE-HI/hi?name=”+name,String.class)方法时，已经做了负载均衡，访问了不同的端口的服务实例" target="_blank" rel="noopener">http://SERVICE-HI/hi?name=”+name,String.class)方法时，已经做了负载均衡，访问了不同的端口的服务实例</a> <img src="https://i.imgur.com/MYrdJoP.png" alt=""></li>
<li>此时的架构：<img src="https://i.imgur.com/eIMdbMC.png" alt=""></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/(二)spring-cloud进阶一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/16/(二)spring-cloud进阶一/" itemprop="url">(二)spring-cloud进阶一</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-16T09:34:42+08:00">
                2018-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote></p>
<h1 id="eureka-server添加权限"><a href="#eureka-server添加权限" class="headerlink" title="eureka server添加权限"></a>eureka server添加权限</h1><ul>
<li>参考：<a href="http://www.cnblogs.com/xiaojunbo/p/7094066.html" title="注册中心加权限" target="_blank" rel="noopener">注册中心加权限</a><h2 id="添加security的相关依赖"><a href="#添加security的相关依赖" class="headerlink" title="添加security的相关依赖"></a>添加security的相关依赖</h2></li>
<li><img src="https://i.imgur.com/4qZuOWs.png" alt=""><h2 id="配置配置文件"><a href="#配置配置文件" class="headerlink" title="配置配置文件"></a>配置配置文件</h2></li>
<li><img src="https://i.imgur.com/bkkLccq.png" alt=""></li>
<li>在spring boot2.X中，开启security已过时，即<code>security.basic.enabled: true</code>配置过时。</li>
<li>可以: <img src="https://i.imgur.com/zDTWd72.png" alt=""><img src="https://i.imgur.com/XeH2Uxk.png" alt=""></li>
<li>ps:[此时启动注册中心，需要输入用户名和密码，但之前的服务提供者eureka-client不能注册成功，需要注册中心为其添加权限]<h1 id="eureka-client添加注册权限"><a href="#eureka-client添加注册权限" class="headerlink" title="eureka client添加注册权限"></a>eureka client添加注册权限</h1></li>
<li>修改client工程的配置文件，设置：<blockquote>
</blockquote>
<pre><code>eureka.client.serviceUrl.defaultZone=http://${username}:${password}@${eureka.instance.hostname}:${server.port}/eureka/
</code></pre></li>
<li>配置如下：<img src="https://i.imgur.com/JL4Nt6A.png" alt=""><h1 id="eureka-client注册不上的问题解决"><a href="#eureka-client注册不上的问题解决" class="headerlink" title="eureka client注册不上的问题解决"></a>eureka client注册不上的问题解决</h1></li>
<li>参考：<a href="https://my.oschina.net/bianxin/blog/1819947" title="Springboot-2.0.2.RELEASE Eureka认证后，服务注册失败问题" target="_blank" rel="noopener">https://my.oschina.net/bianxin/blog/1819947</a></li>
<li>问题是Spring Security引起的，查看源码发现CSRF保护默认是开启的，可以禁用掉即可。</li>
<li><p>spring boot老版本配置：</p>
<blockquote>
</blockquote>
<pre><code>security:   
  basic:
    enabled: true
  user:
    name: admin
    password: 123456
</code></pre></li>
<li><p>新版本解决方案：添加一个配置类禁用csrf如下：(会发现注入服务不需要密码了，说明失去了验证。)<br><img src="https://i.imgur.com/nLNagtM.png" alt="添加配置类禁用csrf"></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/15/(一)spring-cloud入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/15/(一)spring-cloud入门/" itemprop="url">(一)spring cloud入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-15T15:41:26+08:00">
                2018-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote>

<h1 id="spring-cloud介绍"><a href="#spring-cloud介绍" class="headerlink" title="spring cloud介绍"></a>spring cloud介绍</h1><ul>
<li>Spring提供了一系列工具，可以帮助开发人员迅速搭建分布式系统中的公共组件（比如：配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁，主节点选举，分布式session，集群状态）。协助分布式环境中各个系统，为各类服务提供模板性配置。使用spring cloud,开发人员可以搭建实现了这些样板的应用，并且在任何分布式环境下都能工作得很好，小到笔记本电脑，大到数据中心和云平台。</li>
<li>spring cloud官网定义比较抽象，我们可以从简单的东西开始。Spring Cloud是基于spring Boot的，最适合用于管理Spring Boot创建的各个微服务应用。要管理分布式环境下的各个Spring Boot微服务，必然存在服务注册问题。所以我们先从服务的注册谈起。既然是注册，必然有个管理注册中心的服务，各个在Spring Cloud管理下的Spring Boot应用就是需要注册的client。</li>
<li>Spring Cloud使用eureka server,然后所以需要访问配置文件的应用都作为一个eureka client注册上去。eureka是一个高可用的组件，它没有后端缓存，每一个实例注册后需要向注册中心发送心跳，在默认情况下eureka server也是一个eureka client,必须要指定一个server。<h1 id="spring-boot与spring-cloud的区别"><a href="#spring-boot与spring-cloud的区别" class="headerlink" title="spring boot与spring cloud的区别"></a>spring boot与spring cloud的区别</h1></li>
<li>springboot是spring的一套快速配置的脚手架，可以基于springboot快速开发单个微服务，springcloud是一个基于springboot实现的云应用开发工具。</li>
<li>spring boot专注于快速，方便集成单个个体，spring cloud是关注全局的服务治理框架</li>
<li>spring boot使用了默认大于配置的理念，很多集成方案已经帮你选着好了，能不配置就不配置，spring cloud很大一部分是基于springboot来实现的。</li>
<li>spring boot可以离开spring cloud独立使用开发项目，但spring cloud离不开spring boot,属于依赖关系。<h1 id="spring-boot与spring-cloud的版本匹配"><a href="#spring-boot与spring-cloud的版本匹配" class="headerlink" title="spring boot与spring cloud的版本匹配"></a>spring boot与spring cloud的版本匹配</h1></li>
<li>参考：<a href="https://blog.csdn.net/zxl646801924/article/details/80742719" target="_blank" rel="noopener">spring boot与spring cloud的版本匹配</a></li>
<li><img src="https://i.imgur.com/19dmDbt.png" alt="版本匹配"><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1>参考：<a href="https://blog.csdn.net/forezp/article/details/81040925" target="_blank" rel="noopener">spring cloud入门</a><h2 id="创建springboot项目"><a href="#创建springboot项目" class="headerlink" title="创建springboot项目"></a>创建springboot项目</h2></li>
<li><img src="https://i.imgur.com/FE7SQ5P.png" alt=""></li>
<li><img src="https://i.imgur.com/cp4g9Tt.png" alt=""></li>
<li><img src="https://i.imgur.com/fAd5OWZ.png" alt=""></li>
<li><img src="https://i.imgur.com/YqllfbF.png" alt=""></li>
<li><img src="https://i.imgur.com/ze1ttoj.png" alt=""><h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2></li>
<li><img src="https://i.imgur.com/7fRyhIf.png" alt=""></li>
<li><img src="https://i.imgur.com/Tb8BY9O.png" alt=""></li>
<li><img src="https://i.imgur.com/6Rr2aSz.png" alt=""><h2 id="创建服务注册中心"><a href="#创建服务注册中心" class="headerlink" title="创建服务注册中心"></a>创建服务注册中心</h2></li>
<li>创建一个model工程作为服务注册中心，即eureka server,另一个作为eureka client</li>
<li>右键工程–&gt;创建model–&gt;选择spring initialir</li>
<li><img src="https://i.imgur.com/ludOPNn.png" alt=""></li>
<li><img src="https://i.imgur.com/CgGqkxs.png" alt=""></li>
<li><img src="https://i.imgur.com/t7UIfPh.png" alt=""></li>
<li><img src="https://i.imgur.com/iVfuY3f.png" alt=""></li>
<li><img src="https://i.imgur.com/wcQEopY.png" alt=""></li>
<li>创建完后的工程，其pom.xml继承了父pom文件，并引入spring-cloud-starter-netflix-eureka-server的依赖</li>
<li><img src="https://i.imgur.com/ohiYQUR.png" alt=""><h2 id="启动注册服务中心"><a href="#启动注册服务中心" class="headerlink" title="启动注册服务中心"></a>启动注册服务中心</h2></li>
<li>启动一个服务注册中心，只需要一个注解@EnableEurekaServer，这个注解需要在springboot工程的启动application类上加</li>
<li><img src="https://i.imgur.com/DHZHgAU.png" alt=""><h2 id="eureka-server的配置文件"><a href="#eureka-server的配置文件" class="headerlink" title="eureka server的配置文件"></a>eureka server的配置文件</h2></li>
<li>eureka是一个高可用的组件，它没有后端缓存，每一个实例注册之后需要向注册中心发送心跳（因此可以在内存中完成），在默认情况下erureka server也是一个eureka client ,必须要指定一个 server。eureka server的配置文件appication.yml</li>
<li><img src="https://i.imgur.com/6uXm9qd.png" alt=""></li>
<li>运行项目后：</li>
<li><img src="https://i.imgur.com/CHYbFR7.png" alt=""><h2 id="创建一个服务提供者"><a href="#创建一个服务提供者" class="headerlink" title="创建一个服务提供者"></a>创建一个服务提供者</h2></li>
<li>eureka client,当client向server注册时，它会提供一些元数据，例如主机和端口，URL,主页等。eureka server从每个client实例接收心跳消息。如果心跳超时，则通常将该实例从注册server中删除。</li>
<li>创建过程同server类似，创建完pom.xml如下：</li>
<li><img src="https://i.imgur.com/TdgjX2p.png" alt=""></li>
<li><img src="https://i.imgur.com/7dYWz7h.png" alt=""></li>
<li><img src="https://i.imgur.com/j38QtPC.png" alt=""></li>
<li><img src="https://i.imgur.com/2mORUzM.png" alt=""></li>
<li>注解@EnableEurekaClient，表明自己是一个eurekaclient，加在项目启动类：</li>
<li><img src="https://i.imgur.com/gamdgHg.png" alt=""><h2 id="eureka-client的配置文件"><a href="#eureka-client的配置文件" class="headerlink" title="eureka client的配置文件"></a>eureka client的配置文件</h2></li>
<li><img src="https://i.imgur.com/CvxV4zv.png" alt=""></li>
<li>启动工程(server和client)，打开<a href="http://localhost:9876" target="_blank" rel="noopener">http://localhost:9876</a> ，即eureka server 的网址</li>
<li><img src="https://i.imgur.com/lfmT8ut.png" alt=""><h2 id="添加一个简单的业务"><a href="#添加一个简单的业务" class="headerlink" title="添加一个简单的业务"></a>添加一个简单的业务</h2></li>
<li><img src="https://i.imgur.com/0haqJao.png" alt=""></li>
<li><img src="https://i.imgur.com/vp1NCUo.png" alt=""><h2 id="Eureka的自我保护模式"><a href="#Eureka的自我保护模式" class="headerlink" title="Eureka的自我保护模式"></a>Eureka的自我保护模式</h2></li>
<li><img src="https://i.imgur.com/fbzslmz.png" alt=""></li>
<li><img src="https://i.imgur.com/hwMcmf6.png" alt=""></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/11/markdown常用语法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/11/markdown常用语法/" itemprop="url">markdown常用语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-11T14:52:43+08:00">
                2018-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote>

<p>标题：</p>
<p>#h1级标题</p>
<p>##h2级标题</p>
<p>###h3级标题</p>
<p>####h4级标题</p>
<p>#####h5级标题</p>
<p>######h6级标题</p>
<p>分割线：三个以上的短线 即可作出分割线</p>
<hr>
<p>超链接：<a href="网址 , 标题">连接名称</a><br><a href="http://www.izhangbo.cn," title="我是标题" target="_blank" rel="noopener">我是链接名</a><br><a href="/sonfilename/"><i class="icon-refresh"></i> 点我刷新</a></p>
<p>另一种超链接写法：[链接名][链接代号]<br>[here][3]<br>然后在别的地方定义 3 这个详细链接信息，<br>[3]: <a href="http://www.izhangbo.cn" target="_blank" rel="noopener">http://www.izhangbo.cn</a> “聚牛团队”</p>
<p>直接展示链接的写法：<a href="http://www.izhangbo.cn" target="_blank" rel="noopener">http://www.izhangbo.cn</a></p>
<p>键盘键<br><kbd>Ctrl+[</kbd> and <kbd>Ctrl+]</kbd></p>
<p>code格式：反引号<br>Use the <code>printf()</code> function.</p>
<p><code>There is a literal backtick (`) here.针对在代码区段内插入反引号的情况</code> </p>
<p>强调：<br><em>斜体强调</em><br><strong>粗体强调</strong></p>
<p>图片<br><img src="http://www.izhangbo.cn/wp-content/themes/minty/img/logo.png" alt="Alt text" title="Optional title"></p>
<p>使用 icon 图标文字<br><i class="icon-cog"></i></p>
<p>段落：以一个空行开始，以一个空行结束，中间的就是一个段落。</p>
<p>表格：</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Computer</td>
<td>$1600</td>
</tr>
<tr>
<td>Phone</td>
<td>$12</td>
</tr>
<tr>
<td>Pipe</td>
<td>$1</td>
</tr>
</tbody>
</table>
<p>无序列表：使用 - 加一个空格（）</p>
<ul>
<li>无需列表1</li>
<li>无序列表2</li>
<li>无序列表3</li>
</ul>
<p>有序列表：使用 数字 加一个英文句点</p>
<ol>
<li>有序列表</li>
<li>有序列表</li>
<li>有序列表</li>
<li>有序列表</li>
<li>有序列表</li>
</ol>
<p>换行缩进形成代码区块</p>
<pre><code>这里先换行，然后缩进4个空格，之后的内容便可以原样显示了，适合用于显示代码内容。直到文本结束或最后一个存在缩进的行为止。    
</code></pre><p>块引用</p>
<blockquote>
<p>给引用的文本开始位置都加一个 ‘&gt;’，<br>便可组成一个块引用。在块引用中，可以结合<br>其他markdown元素一块使用，比如列表。<br><strong>强调</strong><br>也可以只在第一行加大于号，其他位置不加。</p>
</blockquote>
<blockquote>
<ul>
<li>块引用里使用列表，需要和上面的内容隔开一个空行</li>
<li>记得加空格哦。</li>
</ul>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/11/hexo-next博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/11/hexo-next博客/" itemprop="url">hexo+next博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-11T13:50:49+08:00">
                2018-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote>

<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul>
<li>安装node.js (npm或淘宝镜像cnpm)</li>
<li>安装git 配饰ssh等</li>
<li>下载安装hexo  (cnpm install -g hexo)</li>
</ul>
<h2 id="本地搭建hexo静态博客"><a href="#本地搭建hexo静态博客" class="headerlink" title="本地搭建hexo静态博客"></a>本地搭建hexo静态博客</h2><ul>
<li>新建文件夹，如Blog</li>
<li>进入文件夹右键运行git,输入hexo init(生成hexo模板，翻墙？)</li>
<li>运行cnpm install</li>
<li>运行hexo server(运行程序，访问本地localhost:4000可看到博客已搭建成功)</li>
</ul>
<h2 id="将博客与Github关联"><a href="#将博客与Github关联" class="headerlink" title="将博客与Github关联"></a>将博客与Github关联</h2><ul>
<li>在Github上创建名字为XXX.github.io的项目，XXX为github的用户名</li>
<li>打开本地的MyBlog文件夹项目内的_config.yml配置文件，将其中的type设置为git<blockquote>
</blockquote>
<pre><code>deploy:
  type: git
  repository: https://github.com/BingYuQHS/BingYuQHS.github.io.git
  branch: master
</code></pre></li>
<li>运行：cnpm install –save hexo-deployer-git</li>
<li>运行：hexo clean(删除本地Public目录)</li>
<li>运行：hexo g(本地生成静态文件)</li>
<li>运行：hexo d(将本地静态文件推送至Github)</li>
<li>浏览器访问：<a href="https://bingyuqhs.github.io/" target="_blank" rel="noopener">https://bingyuqhs.github.io/</a></li>
</ul>
<h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><ul>
<li>博客已经搭建好，能通过github的域名访问，也可以绑定自己的域名。（ps:具体的方法后面补充）</li>
</ul>
<h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><ul>
<li>Next主题为例</li>
<li><p>下载主题,下载到Blog目录的themes主题下的next文件夹中</p>
<blockquote>
</blockquote>
<pre><code>git clone https://github.com/iissnan/hexo-theme-next themes/next
</code></pre></li>
<li><p>打开站点的_config.yml配置文件，修改主题为next(主题项目的文件夹名称)</p>
<blockquote>
</blockquote>
<pre><code>theme: next
</code></pre></li>
<li><p>打开主题(不是站点下的)的_config.yml配置文件，选择next主题的样式</p>
<blockquote>
</blockquote>
<pre><code># Scheme Settings
# Schemes
#scheme: Muse
scheme: Mist
#scheme: Pisces
#scheme: Gemini
</code></pre></li>
<li>选择好后，再次部署网站，hexo g、hexo d，查看效果，可在本地hexo server查看后再执行hexo d命令。</li>
</ul>
<h2 id="发布文章"><a href="#发布文章" class="headerlink" title="发布文章"></a>发布文章</h2><ul>
<li>创建博文<blockquote>
</blockquote>
<pre><code>hexo n &quot;博客名字&quot; (= hexo new &quot;博客名字&quot;)
hexo s --debug   (= hexo server --debug，在本地调样式时使用)
hexo clean         (删除本地地Public目录)
hexo g            （本地生成静态文件）
hexo d             (将本地静态文件推送至Github)
</code></pre></li>
<li>执行命令后，会发现在Blog根目录下的source文件夹中的_post文件夹中多了一个 博客名字.md 文件，使用Markdown编辑器打开可进行博文编写。</li>
<li>写好博文并且样式无误后，通过hexo g、hexo d 生成、部署网页。随后可以在浏览器中输入域名浏览。(ps:可以hexo server –debug命令进行本地调试修改)</li>
</ul>
<h2 id="寻找图床"><a href="#寻找图床" class="headerlink" title="寻找图床"></a>寻找图床</h2><ul>
<li>图床，当博文中有图片时，若是少量图片，可以直接把图片存放在source文件夹中，但这显然不合理的，因为图片会占据大量的存储的空间，加载的时候相对缓慢 ，这时考虑把博文里的图片上传到某一网站，然后获得外部链接，使用Markdown语法<code>![图片信息](外部链接)</code>，完成图片的插入，这种网站就被成为图床。</li>
<li>常见的简易的图床网站有：<a href="http://www.tietuku.com/," target="_blank" rel="noopener">贴图库图片外链</a> 国内算比较好的图床我认为有两个：新浪微博和 <a href="https://www.qiniu.com/," title="七牛云官网" target="_blank" rel="noopener">七牛云</a> ，七牛云的使用方法可以参看其他文章。图床最重要的就是稳定速度快，所以在挑选图床的时候一定要仔细，下图是博文插入图片，使用图床外链的示例：</li>
</ul>
<h2 id="个性化设置"><a href="#个性化设置" class="headerlink" title="个性化设置"></a>个性化设置</h2><h3 id="修改基本站点信息"><a href="#修改基本站点信息" class="headerlink" title="修改基本站点信息"></a>修改基本站点信息</h3><ul>
<li>在站点配置文件_config.yml修改基本的站点信息<blockquote>
</blockquote>
<pre><code># Site
title: Flamingo&apos;s Blog
subtitle: hs
description: RunDouble
keywords: 
author: hsQin
avatar: headicon_link
language: zh-Hans
timezone: Asia/Shanghai
</code></pre></li>
<li>依次是网站标题、副标题、网站描述、作者、网站头像外部链接、网站语言、时区等。<h3 id="修改基本主题信息"><a href="#修改基本主题信息" class="headerlink" title="修改基本主题信息"></a>修改基本主题信息</h3></li>
<li>在主题配置文件_config.yml修改基本的主题信息<blockquote>
</blockquote>
<pre><code># Reward
#reward_comment: Donate comment here
wechatpay: /images/wechatpay.jpg
alipay: /images/alipay.jpg
#bitcoin: /images/bitcoin.png
</code></pre></li>
<li>博文打赏的微信、支付宝二维码图片，可以直接把图片放在根目录的source文件夹中，也可以使用图床外链。<blockquote>
</blockquote>
<pre><code># Social Links.
# Usage: `Key: permalink || icon`
# Key is the link label showing to end users.
# Value before `||` delimeter is the target permalink.
# Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.
social:
  GitHub: https://github.com/bingyuqhs || github
  #E-Mail: mailto:yourname@gmail.com || envelope
  #Google: https://plus.google.com/yourname || google
  #Twitter: https://twitter.com/yourname || twitter
  #FB Page: https://www.facebook.com/yourname || facebook
  #VK Group: https://vk.com/yourname || vk
  #StackOverflow: https://stackoverflow.com/yourname || stack-overflow
  #YouTube: https://youtube.com/yourname || youtube
  #Instagram: https://instagram.com/yourname || instagram
  #Skype: skype:yourname?call|chat || skype
social_icons:
  enable: true
  GitHub: github
  icons_only: false
  transition: false
</code></pre></li>
<li>社交外链的设置，即在侧栏展示你的个人社交网站信息。<blockquote>
</blockquote>
<pre><code># Share
# This plugin is more useful in China, make sure you known how to use it.
# And you can find the use guide at official webiste: http://www.jiathis.com/.
# Warning: JiaThis does not support https.
#jiathis:
  ##uid: Get this uid from http://www.jiathis.com/
#add_this_id:
</code></pre></li>
<li>博文分享的插件jiathis,值设置为true。<h3 id="个性化进阶"><a href="#个性化进阶" class="headerlink" title="个性化进阶"></a>个性化进阶</h3><h4 id="添加网易云音乐"><a href="#添加网易云音乐" class="headerlink" title="添加网易云音乐"></a>添加网易云音乐</h4><h4 id="设置背景"><a href="#设置背景" class="headerlink" title="设置背景"></a>设置背景</h4><h4 id="增加菜单条目"><a href="#增加菜单条目" class="headerlink" title="增加菜单条目"></a>增加菜单条目</h4><h2 id="异地同步博客"><a href="#异地同步博客" class="headerlink" title="异地同步博客"></a>异地同步博客</h2></li>
<li>如何将两台电脑上的博客内容同步，及两台电脑上都可以编辑更新博客？要解决这个问题，首先要清楚博客文件地组成：<blockquote>
</blockquote>
<pre><code>node_modules
public
scaffolds
source
themes
_config_yml
db.json
package.json
.deploy_git
</code></pre></li>
<li>以上是利用hexo生成的博客的全部内容，当我们执行hexo d时，真正被推送到github上的有哪些内容呢？</li>
<li>看下guthub上的bingyuqhs.github.io项目，发现里面只有Public目录下的内容。也就是说，博客上呈现的内容其实就是public下的文件内容。那么这个public目录是怎么生成的呢？</li>
<li>一开始hexo init的时候是没有public目录的，而运行hexo g命令时，public目录生成了，也就是说hexo g命令就是用来生成博客文件的（会根据_config.yml，source目录文件以及themes目录下文件生成）。运行hexo clean命令时，public目录被删除了。</li>
<li>现在，我们知道决定博客显示内容的只有一个Public目录，而public目录又是可以动态生成的，那么其实我们只要在不同电脑上同步可以生成Public目录的文件即可。</li>
<li><p>以下文件及目录是必须要同步的：</p>
<blockquote>
<pre><code>source
themes
_config.yml
db.json
package.json
.deploy_git
</code></pre></blockquote>
</li>
<li><p>同步的方式有很多种，可以每次更新后都备份到一个地址。可以采用github去备份，新建一个项目用来存放以上文件，每次更新后推送的gihub上，用作备份同步。</p>
</li>
<li><p>同步完必须的文件后，怎样在其他电脑上也可以更新博客呢？</p>
<blockquote>
</blockquote>
<pre><code>1 下载node.js并安装（官网下载安装），默认会安装npm.
2 下载安装git(官网下载安装)
3 下载安装hexo(方法：npm install -g hexo)【要翻墙】
4 新建一个文件夹，如Blog
5 进入该文件夹内，右键运行git,输入命令：hexo init(生成hexo模板，可能要翻墙)
</code></pre></li>
<li><p>我们重复一开始搭建博客的步骤，重新生成了一个新的模板，这个模板中包含了hexo生成的一些文件。</p>
<blockquote>
</blockquote>
<pre><code>1 git clone我们备份的项目，生成一个文件夹，如BlogData
2 将Blog里面的node_moudules、scaffolds文件夹复制到BlogData里面。
</code></pre></li>
<li><p>做完这些，从表面上看，两台电脑上的BlogData目录下的文件应该都是一样的了，现在运行hexo g、hexo d试试，如果报错就往下看。</p>
<blockquote>
</blockquote>
<pre><code>这是因为.deploy_git没同步，在BlogData目录内运行npm install hexo-deployer-git --save后再次推送即可    
</code></pre></li>
<li>总结流程：当我们每次更新Blog内容后，先利用hexo将public推送到github，然后再将其余必须同步的文件利用git推送到github上。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/11/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hsQin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flamingo's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/11/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-11T13:07:17+08:00">
                2018-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://i4.buimg.com/519918/cbc1ffb39108d3bc.jpg"
                alt="hsQin" />
            
              <p class="site-author-name" itemprop="name">hsQin</p>
              <p class="site-description motion-element" itemprop="description">RunDouble</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/bingyuqhs" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hsQin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
